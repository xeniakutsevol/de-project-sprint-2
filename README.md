# Проектная работа по DWH и пересмотру модели данных
**Брифинг:**
В какой-то момент времени компания понимает, что интернет-магазин становится популярным, количество пользователей растет, расширяются категории и виды товаров, появляются новые атрибуты товаров. Также растет опыт и сложность аналитики, и вместе с этим увеличивается количество и "вес" запросов для построения витрин и анализа данных. Появляется потребность в новых данных по поставщикам, рекламным предложениям и другим фичам. Однако текущая модель данных не позволяет гибко расширять возможности существующей схемы, а значит ее нужно изменить. При этом нужно смигрировать уже имеющиеся данные без потерь и искажений в новую схему.

### Входные данные
1. В наличии доступ до базы данных, права на чтение, изменение, создание, удаление таблиц.
2. Описание схемы/модели данных.
3. Требования к новой модели (включая SLA)
    1. Таблицы модели не должны иметь избыточность.
    2. Из новой модели можно получить те же результаты запрашиваемых данных, что и из старой модели.
    3. Каждая сущность имеет свои атрибуты в рамках одной таблицы.
    4. Новая схема должна поддерживать возможность добавления новых акций и промопредложений.
    5. Из новой модели можно получить те же результаты запрашиваемых данных, что и из старой модели с временем отличающимся не более чем на 1 порядок (x10)
    6. Доступность (99,99) и надежность должны быть не хуже, чем при старой схеме.

### Структура репозитория
Входные данные содержатся в папке `0_old_model_and_requirements`.
Папка `1_migrations` хранит файлы SQL-скрипты обновления базы данных.

## Технические детали
### Как запустить контейнер
Запустите локально команду:

```
docker run -d --rm -p 3000:3000 -p 15432:5432 --name=de-project-sprint-2-server sindb/project-sprint-2:latest
```

После того как запустится контейнер, у вас будут доступны:
1. CloudBeaver
2. PostgreSQL
3. VSCode

Для действий над БД вы можете использовать любой из инструментов:
- Утилиту командной строки `psql`. Подключиться к нужной БД можно командой: `psql postgresql://jovyan:jovyan@localhost:5432/de`.
- Сервис DBeaver. Чтобы использовать его, перейдите по URI `/cloudbeaver/` и нажмите на кнопку `SQL` в верхнем меню. Тогда откроется страница для написания и выполнения запросов.
- CloudBeaver иногда может перенаправить вас на адрес без порта, например, `http://localhost/cloudbeaver` вместо `http://localhost:3000/cloudbeaver`. Исправьте это, вручную дописав порт
- Metabase также позволяет выполнять произвольные запросы на чтение.

В контейнере запущена база данных *PostgreSQL*:
- логин: jovyan
- пароль: jovyan
- порт: 5432
- хост: изнутри контейнера localhost
- база данных: **de**

Вы можете протестировать свой запрос с помощью Python, командной строки и утилиты `psql`, Metabase (URI: `/metabase/`) или DBeaver (URI: `/cloudbeaver/`).
